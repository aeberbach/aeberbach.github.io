<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Amiga 1200 Keyboard, part 3</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Gray Unicorn </a></h1>
                <nav><ul>
                    <li><a href="/pages/about-me.html">About me</a></li>
                    <li><a href="/category/bicycles.html">Bicycles</a></li>
                    <li><a href="/category/books.html">Books</a></li>
                    <li class="active"><a href="/category/computers.html">Computers</a></li>
                    <li><a href="/category/development.html">Development</a></li>
                    <li><a href="/category/games.html">Games</a></li>
                    <li><a href="/category/making.html">Making</a></li>
                    <li><a href="/category/random.html">Random</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/kb-3.html" rel="bookmark"
           title="Permalink to Amiga 1200 Keyboard, part 3">Amiga 1200 Keyboard, part 3</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-04-01T12:00:00+11:00">
                Published: Mon 01 April 2019
        </abbr>
		<br />
        <abbr class="modified" title="2019-04-01T12:00:00+11:00">
                Updated: Mon 01 April 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/adam-eberbach.html">Adam Eberbach</a>
        </address>
<p>In <a href="/category/computers.html">Computers</a>.</p>
<p>tags: <a href="/tag/computers.html">computers</a> <a href="/tag/development.html">development</a> <a href="/tag/retrocomputing.html">retrocomputing</a> </p>
</footer><!-- /.post-info -->      <p>Drawing the schematic.</p>
<p>In the last part the circuit was derived by tracing the membrane in the original A1200 keyboard. This time that circuit is going to be turned into a schematic drawing, with the output being a netlist - simply, a list of pins connected to parts (keyswitches, LED, connector) that are connected together.</p>
<p>Because it makes for nice organisation they keys in the schematic go in roughly the same place they would be on a real keyboard. Compared to making a PCB schematic is not hard at all - wires can cross and go pretty much anywhere as long as you can keep track of them. Unless you see a big green dot you don't have a connection. Obviously you don't want to make something you can't read so keeping it neat is a good idea.</p>
<p><a href="/images/a1200-kbd-3/schematic.jpg"><img alt="Part of schematic drawing" src="/images/a1200-kbd-3/thumb-schematic.jpg"></a></p>
<p>Looking at the circuit you can see that it is a matrix. The keys, with two terminals each, could be directly connected to the controller, for around 200 connections from keyboard to controller. Or like a joystick they could all use one common connection and then there would only be 100 wires or so, one from each switch plus one common. But better still is to use a matrix where a key is defined by two connections, and when those connections are bridged the controller derives a unique key. The minimum you would need is rows + columns connections - so in a really simple keyboard like this standalone numpad:</p>
<p><img alt="GoldTouch numpad" src="/images/a1200-kbd-3/numpad.jpg"></p>
<p>The minimum would be only 10 connections from matrix to controller because there are 4 column and 6 rows. All this minimisation is good because connections cost time and money. The Amiga however has a special set of keys with their own connections not shared with the regular matrix. These are keys like CTRL, L-AMIGA etc - the ones that can't be blocked by another key. Ignoring the connections to the LED that lights when CAPSLOCK is pressed it uses 29 connections to the controller chip, via the ribbon cable that emerges from the top of the membrane.</p>
<p>I could write a whole article about the keyboard matrix and try to make it good, but it's been done really well already - please take a look at <a href="http://blog.komar.be/how-to-make-a-keyboard-the-matrix/">komar's tech blog</a>.</p>
<p>Because I just want to make a replacement keyboard I am not using diodes or changing the layout in any way from the original. The circuit is exactly the same right down to the flipped row/column connections on some of the keys like F6. I do not think that making all this completely regular could have had an effect, as these are just passive switches, but I'm not changing it. The keyboard should be better with mechanical switches, but it should not be electrically different - bugs and all.</p>
<p>When the schematic is done the output is a netlist. This is just a text file that defines what's in the circuit and how the things are connected. The first part describes the components. Here are two entries (and part of a third) describing the switches:</p>
<div class="highlight"><pre><span></span>  (components
    (comp (ref K2)
      (value F1)
      (footprint MX_Alps_Hybrid:MXOnly-1.25U-NoLED)
      (libsource (lib MX_Alps_Hybrids) (part MX-1.25U) (description &quot;&quot;))
      (sheetpath (names /) (tstamps /))
      (tstamp 5C7001B7))
    (comp (ref K3)
      (value F2)
      (footprint MX_Alps_Hybrid:MXOnly-1.25U-NoLED)
      (libsource (lib MX_Alps_Hybrids) (part MX-1.25U) (description &quot;&quot;))
      (sheetpath (names /) (tstamps /))
      (tstamp 5C70020E))
    (comp (ref K4)
      (value F3)
      (footprint MX_Alps_Hybrid:MXOnly-1.25U-NoLED)
      (libsource (lib MX_Alps_Hybrids) (part MX-1.25U) (description &quot;&quot;))
</pre></div>


<p>I'm using the excellent library by github user <a href="https://github.com/ai03-2725/MX_Alps_Hybrid.pretty">ai03-2725</a> - highly recommended. I don't love the schematic symbols, because all of the keys have a diode which when unconnected causes KiCAD to complain when transferring to PC. But the PCB footprints are excellent!</p>
<p>Late in the netlist comes the description of the nets themselves - here's one of them:</p>
<div class="highlight"><pre><span></span>    (net (code 198) (name /18)
      (node (ref K36) (pin 1))
      (node (ref K55) (pin 1))
      (node (ref K3) (pin 1))
      (node (ref J1) (pin 18))
      (node (ref K74) (pin 1))
      (node (ref K15) (pin 1))
      (node (ref K68) (pin 1)))
</pre></div>


<p>This means that there is a net named "18", joining the pins of the components listed. I named is "18" because it matches pin 18 of the connector. And it's as simple as that. If you look at the netlist file you can manually check that all of the nets are connected the way you wanted them. This is a good idea because though it is not an exciting job it's a lot better than soldering bits of wire on your new PCB correcting in hardware the errors you should have fixed on paper.</p>
<p>Next time - making the PCB.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>