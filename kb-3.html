<!doctype html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<title>Gray Unicorn</title>
		<meta name="description" content="">
		<meta name="author" content="Adam Eberbach">

		<link rel="stylesheet" href="/theme/css/foundation.css" />
		<link rel="stylesheet" href="/theme/css/pygment/monokai.css" />
		<link rel="stylesheet" href="/theme/css/custom.css" />


		<script src="/theme/js/modernizr.js"></script>

		<!-- Feeds -->

<script>var _gaq=[['_setAccount','UA-46719042-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

		<!-- mathjax config similar to math.stackexchange -->
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			jax: ["input/TeX", "output/HTML-CSS"],
			tex2jax: {
				inlineMath: [ ['$', '$'] ],
				displayMath: [ ['$$', '$$']],
				processEscapes: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
			},
			messageStyle: "none",
			"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
		});
		</script>
		<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	</head>
	<body>
		<div class="off-canvas-wrap">
			<div class="inner-wrap">
				<!-- mobile top bar to activate nav -->
				<nav class="tab-bar show-for-small">
					<section class="left-small">
						<a class="left-off-canvas-toggle menu-icon" ><span></span></a>
					</section>

					<section class="middle tab-bar-section">
						<h1 class="title">Gray&nbsp;Unicorn</h1>
					</section>
				</nav>

				<!-- mobile side bar nav -->
				<aside class="left-off-canvas-menu">
					<ul class="off-canvas-list">
						<li><a href="">Home</a></li>
						<li><label>Categories</label></li>
							<li ><a href="/category/3dprinting.html">3DPrinting</a></li>
							<li ><a href="/category/bicycles.html">Bicycles</a></li>
							<li ><a href="/category/books.html">Books</a></li>
							<li class="active"><a href="/category/computers.html">Computers</a></li>
							<li ><a href="/category/development.html">Development</a></li>
							<li ><a href="/category/games.html">Games</a></li>
							<li ><a href="/category/making.html">Making</a></li>
							<li ><a href="/category/random.html">Random</a></li>

						<li><label>Links</label></li>

						<li><label>Tags</label></li>
							<li><a href="/tag/3dprinting.html">3dprinting</a></li>
							<li><a href="/tag/belt.html">belt</a></li>
							<li><a href="/tag/bicycle.html">bicycle</a></li>
							<li><a href="/tag/books.html">books</a></li>
							<li><a href="/tag/computers.html">computers</a></li>
							<li><a href="/tag/development.html">development</a></li>
							<li><a href="/tag/drifter.html">drifter</a></li>
							<li><a href="/tag/electronics.html">electronics</a></li>
							<li><a href="/tag/games.html">games</a></li>
							<li><a href="/tag/making.html">making</a></li>
							<li><a href="/tag/random.html">random</a></li>
							<li><a href="/tag/retrocomputing.html">retrocomputing</a></li>
							<li><a href="/tag/shimano.html">shimano</a></li>
							<li><a href="/tag/soma.html">SOMA</a></li>
							<li><a href="/tag/spot.html">spot</a></li>

						<li><label>Monthly Archives</label></li>
									<li><a href="/posts/2019/12/index.html">December 2019 (2)</a></li>
									<li><a href="/posts/2019/11/index.html">November 2019 (1)</a></li>
									<li><a href="/posts/2019/10/index.html">October 2019 (1)</a></li>
									<li><a href="/posts/2019/08/index.html">August 2019 (1)</a></li>
									<li><a href="/posts/2019/07/index.html">July 2019 (1)</a></li>
									<li><a href="/posts/2019/05/index.html">May 2019 (2)</a></li>
									<li><a href="/posts/2019/04/index.html">April 2019 (6)</a></li>
									<li><a href="/posts/2019/03/index.html">March 2019 (3)</a></li>
									<li><a href="/posts/2016/04/index.html">April 2016 (3)</a></li>
									<li><a href="/posts/2015/09/index.html">September 2015 (1)</a></li>
									<li><a href="/posts/2015/07/index.html">July 2015 (3)</a></li>
									<li><a href="/posts/2014/05/index.html">May 2014 (3)</a></li>
									<li><a href="/posts/2012/09/index.html">September 2012 (1)</a></li>
									<li><a href="/posts/2012/07/index.html">July 2012 (1)</a></li>
									<li><a href="/posts/2012/05/index.html">May 2012 (3)</a></li>

						<li><label>Social</label></li>
					</ul>	
				</aside>

				<!-- top bar nav -->
				<nav class="top-bar hide-for-small-only" data-topbar>
					<ul class="title-area">
						<li class="name">
							<h1><a href="/">Gray Unicorn</a></h1>
						</li>
					</ul>

					<section class="top-bar-section">
						<ul class="left">
								<li ><a href="/category/3dprinting.html">3DPrinting</a></li>
								<li ><a href="/category/bicycles.html">Bicycles</a></li>
								<li ><a href="/category/books.html">Books</a></li>
								<li class="active"><a href="/category/computers.html">Computers</a></li>
								<li ><a href="/category/development.html">Development</a></li>
								<li ><a href="/category/games.html">Games</a></li>
								<li ><a href="/category/making.html">Making</a></li>
								<li ><a href="/category/random.html">Random</a></li>
						</ul>
                        <ul class="right">                                                                                                                                           
                                                                                                          
路路路路                                                                                                                                       
                                     <li><a href="/pages/me.html">About me</a></li>                                    
                                                                                                                                          
                                                                                                                                             
                        </ul>  
					</section>
				</nav>

				<!-- Main Page Content and Sidebar -->
				<section class="main-section">
					<div class="row">
						<!-- Main Content -->
						<div class="medium-9 small-12 columns" role="content">
<article>
	<h2>Amiga 1200 Keyboard, part 3</h2>
	<p>Drawing the schematic.</p>
<p>In the last part the circuit was derived by tracing the membrane in the original A1200 keyboard. This time that circuit is going to be turned into a schematic drawing, with the output being a netlist - simply, a list of pins connected to parts (keyswitches, LED, connector) that are connected together.</p>
<p>Because it makes for nice organisation they keys in the schematic go in roughly the same place they would be on a real keyboard. Compared to making a PCB schematic is not hard at all - wires can cross and go pretty much anywhere as long as you can keep track of them. Unless you see a big green dot you don't have a connection. Obviously you don't want to make something you can't read so keeping it neat is a good idea.</p>
<p><a href="/images/a1200-kbd-3/schematic.jpg"><img alt="Part of schematic drawing" src="/images/a1200-kbd-3/thumb-schematic.jpg"></a></p>
<p>Looking at the circuit you can see that it is a matrix. The keys, with two terminals each, could be directly connected to the controller, for around 200 connections from keyboard to controller. Or like a joystick they could all use one common connection and then there would only be 100 wires or so, one from each switch plus one common. But better still is to use a matrix where a key is defined by two connections, and when those connections are bridged the controller derives a unique key. The minimum you would need is rows + columns connections - so in a really simple keyboard like this standalone numpad:</p>
<p><img alt="GoldTouch numpad" src="/images/a1200-kbd-3/numpad.jpg"></p>
<p>The minimum would be only 10 connections from matrix to controller because there are 4 column and 6 rows. All this minimisation is good because connections cost time and money. The Amiga however has a special set of keys with their own connections not shared with the regular matrix. These are keys like CTRL, L-AMIGA etc - the ones that can't be blocked by another key. Ignoring the connections to the LED that lights when CAPSLOCK is pressed it uses 29 connections to the controller chip, via the ribbon cable that emerges from the top of the membrane.</p>
<p>I could write a whole article about the keyboard matrix and try to make it good, but it's been done really well already - please take a look at <a href="http://blog.komar.be/how-to-make-a-keyboard-the-matrix/">komar's tech blog</a>.</p>
<p>Because I just want to make a replacement keyboard I am not using diodes or changing the layout in any way from the original. The circuit is exactly the same right down to the flipped row/column connections on some of the keys like F6. I do not think that making all this completely regular could have had an effect, as these are just passive switches, but I'm not changing it. The keyboard should be better with mechanical switches, but it should not be electrically different - bugs and all.</p>
<p>When the schematic is done the output is a netlist. This is just a text file that defines what's in the circuit and how the things are connected. The first part describes the components. Here are two entries (and part of a third) describing the switches:</p>
<div class="highlight"><pre><span></span>  <span class="p">(</span><span class="n">components</span>
    <span class="p">(</span><span class="n">comp</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K2</span><span class="p">)</span>
      <span class="p">(</span><span class="n">value</span> <span class="n">F1</span><span class="p">)</span>
      <span class="p">(</span><span class="n">footprint</span> <span class="n">MX_Alps_Hybrid</span><span class="p">:</span><span class="n">MXOnly</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="n">U</span><span class="o">-</span><span class="n">NoLED</span><span class="p">)</span>
      <span class="p">(</span><span class="n">libsource</span> <span class="p">(</span><span class="n">lib</span> <span class="n">MX_Alps_Hybrids</span><span class="p">)</span> <span class="p">(</span><span class="n">part</span> <span class="n">MX</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="n">U</span><span class="p">)</span> <span class="p">(</span><span class="n">description</span> <span class="ss">&quot;&quot;</span><span class="p">))</span>
      <span class="p">(</span><span class="n">sheetpath</span> <span class="p">(</span><span class="k">names</span> <span class="o">/</span><span class="p">)</span> <span class="p">(</span><span class="n">tstamps</span> <span class="o">/</span><span class="p">))</span>
      <span class="p">(</span><span class="n">tstamp</span> <span class="mi">5</span><span class="n">C7001B7</span><span class="p">))</span>
    <span class="p">(</span><span class="n">comp</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K3</span><span class="p">)</span>
      <span class="p">(</span><span class="n">value</span> <span class="n">F2</span><span class="p">)</span>
      <span class="p">(</span><span class="n">footprint</span> <span class="n">MX_Alps_Hybrid</span><span class="p">:</span><span class="n">MXOnly</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="n">U</span><span class="o">-</span><span class="n">NoLED</span><span class="p">)</span>
      <span class="p">(</span><span class="n">libsource</span> <span class="p">(</span><span class="n">lib</span> <span class="n">MX_Alps_Hybrids</span><span class="p">)</span> <span class="p">(</span><span class="n">part</span> <span class="n">MX</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="n">U</span><span class="p">)</span> <span class="p">(</span><span class="n">description</span> <span class="ss">&quot;&quot;</span><span class="p">))</span>
      <span class="p">(</span><span class="n">sheetpath</span> <span class="p">(</span><span class="k">names</span> <span class="o">/</span><span class="p">)</span> <span class="p">(</span><span class="n">tstamps</span> <span class="o">/</span><span class="p">))</span>
      <span class="p">(</span><span class="n">tstamp</span> <span class="mi">5</span><span class="n">C70020E</span><span class="p">))</span>
    <span class="p">(</span><span class="n">comp</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K4</span><span class="p">)</span>
      <span class="p">(</span><span class="n">value</span> <span class="n">F3</span><span class="p">)</span>
      <span class="p">(</span><span class="n">footprint</span> <span class="n">MX_Alps_Hybrid</span><span class="p">:</span><span class="n">MXOnly</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="n">U</span><span class="o">-</span><span class="n">NoLED</span><span class="p">)</span>
      <span class="p">(</span><span class="n">libsource</span> <span class="p">(</span><span class="n">lib</span> <span class="n">MX_Alps_Hybrids</span><span class="p">)</span> <span class="p">(</span><span class="n">part</span> <span class="n">MX</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="n">U</span><span class="p">)</span> <span class="p">(</span><span class="n">description</span> <span class="ss">&quot;&quot;</span><span class="p">))</span>
</pre></div>


<p>I'm using the excellent library by github user <a href="https://github.com/ai03-2725/MX_Alps_Hybrid.pretty">ai03-2725</a> - highly recommended. I don't love the schematic symbols, because all of the keys have a diode which when unconnected causes KiCAD to complain when transferring to PC. But the PCB footprints are excellent!</p>
<p>Late in the netlist comes the description of the nets themselves - here's one of them:</p>
<div class="highlight"><pre><span></span>    <span class="p">(</span><span class="n">net</span> <span class="p">(</span><span class="n">code</span> <span class="mi">198</span><span class="p">)</span> <span class="p">(</span><span class="n">name</span> <span class="o">/</span><span class="mi">18</span><span class="p">)</span>
      <span class="p">(</span><span class="n">node</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K36</span><span class="p">)</span> <span class="p">(</span><span class="n">pin</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="n">node</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K55</span><span class="p">)</span> <span class="p">(</span><span class="n">pin</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="n">node</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K3</span><span class="p">)</span> <span class="p">(</span><span class="n">pin</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="n">node</span> <span class="p">(</span><span class="k">ref</span> <span class="n">J1</span><span class="p">)</span> <span class="p">(</span><span class="n">pin</span> <span class="mi">18</span><span class="p">))</span>
      <span class="p">(</span><span class="n">node</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K74</span><span class="p">)</span> <span class="p">(</span><span class="n">pin</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="n">node</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K15</span><span class="p">)</span> <span class="p">(</span><span class="n">pin</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="n">node</span> <span class="p">(</span><span class="k">ref</span> <span class="n">K68</span><span class="p">)</span> <span class="p">(</span><span class="n">pin</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>


<p>This means that there is a net named "18", joining the pins of the components listed. I named is "18" because it matches pin 18 of the connector. And it's as simple as that. If you look at the netlist file you can manually check that all of the nets are connected the way you wanted them. This is a good idea because though it is not an exciting job it's a lot better than soldering bits of wire on your new PCB correcting in hardware the errors you should have fixed on paper.</p>
<p>Next time - making the PCB.</p>
	<hr/>
	<h6>Written by <a href="/author/adam-eberbach.html">Adam Eberbach</a> in <a href="/category/computers.html">Computers</a> on Mon 01 April 2019. Tags: <a href="/tag/computers.html">computers</a>, <a href="/tag/development.html">development</a>, <a href="/tag/retrocomputing.html">retrocomputing</a>, </h6>
</article>

<hr/>
						</div>
						<!-- End Main Content -->
						<!-- Sidebar -->
						<aside class="medium-3 hide-for-small-only columns">
							<div class="panel">
								<h5>Links</h5>
								<ul class="side-nav">
								</ul>
							</div>

							<div class="panel">
								<h5>Tags</h5>
								<ul class="tag-cloud">
								</ul>
							</div>

							<div class="panel">
								<h5>Monthly Archives</h5>
								<ul class="side-nav">
											<li><a href="/posts/2019/12/index.html">December 2019 (2)</a></li>
											<li><a href="/posts/2019/11/index.html">November 2019 (1)</a></li>
											<li><a href="/posts/2019/10/index.html">October 2019 (1)</a></li>
											<li><a href="/posts/2019/08/index.html">August 2019 (1)</a></li>
											<li><a href="/posts/2019/07/index.html">July 2019 (1)</a></li>
											<li><a href="/posts/2019/05/index.html">May 2019 (2)</a></li>
											<li><a href="/posts/2019/04/index.html">April 2019 (6)</a></li>
											<li><a href="/posts/2019/03/index.html">March 2019 (3)</a></li>
											<li><a href="/posts/2016/04/index.html">April 2016 (3)</a></li>
											<li><a href="/posts/2015/09/index.html">September 2015 (1)</a></li>
											<li><a href="/posts/2015/07/index.html">July 2015 (3)</a></li>
											<li><a href="/posts/2014/05/index.html">May 2014 (3)</a></li>
											<li><a href="/posts/2012/09/index.html">September 2012 (1)</a></li>
											<li><a href="/posts/2012/07/index.html">July 2012 (1)</a></li>
											<li><a href="/posts/2012/05/index.html">May 2012 (3)</a></li>
								</ul>
							</div>

							<div class="panel">
								<h5>Social</h5>
								<ul class="side-nav">
								</ul>
							</div>
						</aside>
						<!-- End Sidebar -->
					</div>

					<!-- Footer -->
					<footer class="row">
						<div class="medium-9 small-12">
							<hr/>
							<p class="text-center">Powered by <a href="http://getpelican.com">Pelican</a> and <a href="http://foundation.zurb.com/">Zurb Foundation</a>. Theme by <a href="http://hamaluik.com">Kenton Hamaluik</a>.</p>
						</div>
					</footer>
					<!-- End Footer -->
				</section>
				<a class="exit-off-canvas"></a>
			</div><!--off-canvas inner-->
		</div><!--off-canvas wrap-->

		<script src="/theme/js/jquery.js"></script>
		<script src="/theme/js/foundation.min.js"></script>
		<script>
			$(document).foundation();
		</script>
	</body>
</html>